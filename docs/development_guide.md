# P波初至震相拾取系统开发指南

## 1. 开发环境设置

### 1.1 环境要求

- Python 3.7+
- Git
- 代码编辑器（推荐使用VS Code或PyCharm）
- 虚拟环境管理工具（推荐使用venv或conda）

### 1.2 开发环境配置

1. 克隆代码仓库：
```bash
git clone https://github.com/your-username/p-wave-picker.git
cd p-wave-picker
```

2. 创建虚拟环境：
```bash
python -m venv venv
source venv/bin/activate  # Linux/macOS
venv\Scripts\activate     # Windows
```

3. 安装开发依赖：
```bash
pip install -r requirements-dev.txt
```

4. 安装预提交钩子：
```bash
pre-commit install
```

## 2. 代码规范

### 2.1 Python代码规范

- 遵循PEP 8规范
- 使用类型注解
- 编写详细的文档字符串
- 使用有意义的变量名和函数名
- 保持代码简洁和可读性

### 2.2 文件组织

```
p-wave-picker/
├── core/               # 核心功能模块
├── gui/               # GUI组件
├── utils/             # 工具函数
├── config/            # 配置文件
├── tests/             # 测试文件
├── docs/              # 文档
├── examples/          # 示例数据
├── main.py           # 主程序
├── requirements.txt   # 依赖包
└── README.md         # 项目说明
```

### 2.3 命名规范

- 类名：使用驼峰命名法（如`FileManager`）
- 函数名：使用小写字母和下划线（如`load_file`）
- 变量名：使用小写字母和下划线（如`file_path`）
- 常量名：使用大写字母和下划线（如`MAX_FILES`）

### 2.4 注释规范

- 使用文档字符串描述类、函数和模块
- 使用行内注释解释复杂的代码逻辑
- 保持注释的及时更新

## 3. 开发流程

### 3.1 分支管理

- `main`：主分支，保持稳定
- `develop`：开发分支，用于集成功能
- `feature/*`：功能分支，用于开发新功能
- `bugfix/*`：修复分支，用于修复bug
- `release/*`：发布分支，用于准备发布

### 3.2 开发流程

1. 从`develop`分支创建功能分支
2. 在功能分支上开发
3. 提交代码并推送到远程
4. 创建Pull Request
5. 代码审查
6. 合并到`develop`分支
7. 定期从`develop`分支合并到`main`分支发布

### 3.3 提交规范

提交信息格式：
```
<type>(<scope>): <subject>

<body>

<footer>
```

类型（type）：
- feat：新功能
- fix：修复bug
- docs：文档更新
- style：代码格式
- refactor：重构
- test：测试
- chore：构建过程或辅助工具的变动

## 4. 测试规范

### 4.1 单元测试

- 使用`pytest`框架
- 测试文件命名：`test_*.py`
- 测试函数命名：`test_*`
- 保持测试的独立性
- 使用`fixture`共享测试资源

### 4.2 测试覆盖率

- 使用`pytest-cov`检查测试覆盖率
- 保持核心模块的测试覆盖率在80%以上
- 定期运行测试并检查覆盖率报告

### 4.3 测试运行

```bash
# 运行所有测试
pytest

# 运行特定测试
pytest tests/test_file_manager.py

# 检查测试覆盖率
pytest --cov=core tests/
```

## 5. 文档规范

### 5.1 代码文档

- 使用Google风格的文档字符串
- 包含参数说明、返回值和异常说明
- 提供使用示例

### 5.2 项目文档

- README.md：项目概述和快速开始
- 用户手册：详细的使用说明
- API文档：接口说明
- 开发指南：开发流程和规范

### 5.3 文档更新

- 代码变更时同步更新相关文档
- 定期检查和更新文档
- 保持文档的准确性和及时性

## 6. 发布流程

### 6.1 版本号规范

遵循语义化版本（Semantic Versioning）：
- 主版本号：不兼容的API修改
- 次版本号：向下兼容的功能性新增
- 修订号：向下兼容的问题修正

### 6.2 发布步骤

1. 更新版本号
2. 更新CHANGELOG.md
3. 运行测试
4. 构建发布包
5. 创建发布标签
6. 发布到PyPI

### 6.3 发布检查清单

- [ ] 所有测试通过
- [ ] 文档已更新
- [ ] 版本号已更新
- [ ] CHANGELOG已更新
- [ ] 依赖包版本已检查
- [ ] 发布包已构建
- [ ] 发布标签已创建

## 7. 性能优化

### 7.1 性能指标

- 文件加载时间
- 波形显示响应时间
- 自动拾取处理时间
- 内存使用情况

### 7.2 优化方法

- 使用性能分析工具（如cProfile）
- 优化算法复杂度
- 使用缓存机制
- 异步处理耗时操作
- 优化数据结构

### 7.3 性能测试

- 使用大量数据测试
- 监控内存使用
- 测试并发性能
- 测试长时间运行稳定性

## 8. 安全规范

### 8.1 代码安全

- 避免硬编码敏感信息
- 使用安全的文件操作
- 验证用户输入
- 处理异常情况

### 8.2 数据安全

- 备份重要数据
- 加密敏感信息
- 控制文件访问权限
- 记录关键操作日志

## 9. 贡献指南

### 9.1 如何贡献

1. Fork项目
2. 创建功能分支
3. 提交更改
4. 推送到分支
5. 创建Pull Request

### 9.2 贡献规范

- 遵循代码规范
- 编写测试用例
- 更新相关文档
- 提供清晰的提交信息

### 9.3 代码审查

- 检查代码质量
- 验证功能完整性
- 确保测试覆盖
- 检查文档更新

## 10. 常见问题

### 10.1 开发问题

Q: 如何处理依赖冲突？
A: 使用虚拟环境，并定期更新依赖包。

Q: 如何调试GUI问题？
A: 使用日志记录，并添加调试模式。

### 10.2 测试问题

Q: 如何测试GUI组件？
A: 使用模拟对象和事件触发。

Q: 如何处理测试数据？
A: 使用测试夹具和模拟数据。

### 10.3 发布问题

Q: 如何回滚发布？
A: 使用Git标签和版本控制。

Q: 如何处理用户反馈？
A: 建立问题跟踪系统，及时响应用户反馈。 